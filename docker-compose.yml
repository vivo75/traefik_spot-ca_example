---
version: "3.9"

services:
  traefik:
    image: "traefik:v2.10"
    ports:
      - "8080:8080"
      - "80:80"
    volumes:
      - type: bind
        source: ./traefik/traefik.yml
        target: /etc/traefik/traefik.yml
        read_only: True
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock

  traefik-test:
    image: traefik/whoami:latest
    labels:
      traefik.http.routers.testproxy.rule: "Host(`test.net`)"
      traefik.http.services.testservice.loadbalancer.server.port: "80"

  api-server:
    build:
      context: ./api-server/
    labels:
      traefik.http.routers.apiproxy1.rule: "Host(`api1.test.net`)"
      traefik.http.services.apiservice1.loadbalancer.server.port: "80"
    networks:
      default:
        aliases:
          - api1.test.net

  api-server2:
    build:
      context: ./api-server2/
    labels:
      traefik.http.routers.apiproxy2.rule: "Host(`api2.test.net`) || Host(`api3.test.net`) "
      traefik.http.services.apiservice2.loadbalancer.server.port: "80"
    networks:
      default:
        aliases:
          - api2.test.net
          - api3.test.net

  api-client:
    build:
      context: ./client/
